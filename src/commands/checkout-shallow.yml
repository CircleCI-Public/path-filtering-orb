description: >
  Provides git shallow clone instead of full clone.
  This command is for simple usage when you don't need options for clone, fetch and tag fetch.
parameters:
  depth:
    description: |
      Limit fetch depth to the specified number of commit from a remote branch history.
      Refer git fetch documentation for more information.
    type: string
    default: "1"
  fetch_depth:
    description: |
      Addtional fetch depth to the specified number of commit from a remote branch history.
      Pass more number then depth when you want to check futher commit history.
    type: string
    default: "10"
  no_tags:
    description: |
      true to add '--no-tags' when fetching.
      As git not offer tag depth, we only able to control fetch all tags or not.
      This enable you to stop fetch tags when you have vast numbers of tags during specified fetch depth.
      In other word, if you need tag then fetch specified tags manually when use 'without_tag: true'.
    type: boolean
    default: false
  keyscan_github:
    description: |
      Pass `true` to dynamically get ssh-rsa from `github.com`.
    type: boolean
    default: false
  keyscan_bitbucket:
    description: |
      Pass `true` to dynamically get ssh-rsa from `bitbucket.org`.
    type: boolean
    default: false
  path:
    description: |
      Checkout directory (default: job working_directory)
    type: string
    default: .
steps:
  - run:
      environment:
        KEYSCAN_GITHUB: <<parameters.keyscan_github>>
        KEYSCAN_BITBUCKET: <<parameters.keyscan_bitbucket>>
        NO_TAGS: << parameters.no_tags >>
        REPO_PATH: << parameters.path >>
        DEPTH: << parameters.depth >>
        FETCH_DEPTH: << parameters.fetch_depth >>
      name: Checkout code shallow
      command: <<include(scripts/checkout-shallow.sh)>>
